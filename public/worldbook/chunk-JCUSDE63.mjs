var c={weather:["\u5929\u6C14","\u6C14\u5019","\u4E0B\u96E8","\u53F0\u98CE","\u6E29\u5EA6","\u9884\u62A5","\u9884\u8B66"],restaurant:["\u9910\u5385","\u7F8E\u98DF","\u5403\u996D","\u9910\u9986","\u996D\u5E97","\u5C0F\u5403"],travel:["\u65C5\u884C","\u65C5\u6E38","\u884C\u7A0B","\u51FA\u884C"],tips:["\u6CE8\u610F\u4E8B\u9879","\u8D34\u58EB","\u63D0\u793A"],safety:["\u5B89\u5168","\u98CE\u9669","\u5371\u9669","\u9884\u8B66"],attraction:["\u666F\u70B9","\u516C\u56ED","\u6D77\u6E7E","\u6C99\u6EE9","\u73A9"],shopping:["\u8D2D\u7269","\u514D\u7A0E\u5E97","\u7279\u4EA7"],food:["\u7F8E\u98DF","\u83DC","\u5C0F\u5403","\u7279\u8272"],hainan:["\u6D77\u5357","\u6D77\u53E3","\u4E09\u4E9A","\u4E9A\u9F99\u6E7E"],haikou:["\u6D77\u5357","\u6D77\u53E3","\u4E09\u4E9A","\u4E9A\u9F99\u6E7E"],sanya:["\u6D77\u5357","\u6D77\u53E3","\u4E09\u4E9A","\u4E9A\u9F99\u6E7E"],yalong:["\u6D77\u5357","\u6D77\u53E3","\u4E09\u4E9A","\u4E9A\u9F99\u6E7E"]},f=class{static import(r){if(!r||typeof r!="object")throw new Error("Invalid worldbook data");let e={...r};return e.worldbook&&Array.isArray(e.worldbook)&&!e.entries&&(e.entries=e.worldbook,delete e.worldbook),Array.isArray(e.entries)||(e.entries=[]),e.entries=e.entries.map((a,o)=>{let t={...a},s=[],p=["keys","key","keywords","primary_keys","\u5173\u952E\u8BCD","\u89E6\u53D1\u8BCD"];for(let i of p)if(t[i]){if(typeof t[i]=="string")s.push(...t[i].split(/[,\s、，;；|\/]+/).map(n=>n.trim()).filter(n=>n.length>0));else if(Array.isArray(t[i]))s.push(...t[i]);else if(typeof t[i]=="object"&&t[i].primary){let n=Array.isArray(t[i].primary)?t[i].primary:[],l=Array.isArray(t[i].secondary)?t[i].secondary:[];s.push(...n),l.length>0&&(t.optionalFilter=t.optionalFilter||{keys:[],logic:"AND_ANY"},t.optionalFilter.keys=l)}i!=="keys"&&delete t[i]}if(t.keys=s.length>0?this.expandEnglishKeys(s):[],!t.content&&t.content!==""&&(t.entry?(t.content=t.entry,delete t.entry):t.text?(t.content=t.text,delete t.text):t.content=""),t.enabled===void 0&&(t.enabled=!0),typeof t.position=="number"){let i={0:"before_char",1:"after_char",2:"before_example",3:"after_example",4:"before_an",5:"after_an",6:"at_depth"};t.position=i[t.position]||"after_char"}else if(typeof t.position=="string"){let i={before_char:"before_char",after_char:"after_char",before_example:"before_example",after_example:"after_example",before_an:"before_an",after_an:"after_an",at_depth:"at_depth",top:"before_char",beforeMain:"before_an",afterMain:"after_an",afterSystem:"after_char",bottom:"after_char",floating:"after_char",unknown:"after_char"};t.position=i[t.position]||t.position}else t.position||(t.position="after_char");return!t.id&&t.id!==0&&(t.id=`entry_${o}`),t}),e}static expandEnglishKeys(r){let e=[...r];for(let a of r){let o=a.toLowerCase();c[o]&&e.push(...c[o])}return[...new Set(e.map(a=>a.replace(/[\uFF01-\uFF5E]/g,o=>String.fromCharCode(o.charCodeAt(0)-65248)).replace(/\u3000/g," ").trim()))].filter(a=>a.length>0)}static validate(r){if(!r||typeof r!="object")return{valid:!1,errors:["Worldbook must be an object"]};if(!Array.isArray(r.entries))return{valid:!1,errors:["Worldbook must have an entries array"]};let e=[];return r.entries.forEach((a,o)=>{!a.id&&a.id!==0&&e.push(`Entry at index ${o} is missing id`),Array.isArray(a.keys)||e.push(`Entry at index ${o} is missing keys array`),!a.content&&a.content!==""&&e.push(`Entry at index ${o} is missing content`)}),{valid:e.length===0,errors:e}}static export(r){return{name:r.name,description:r.description,version:r.version,entries:r.entries.map(e=>({id:e.id,name:e.name,keys:e.keys,content:e.content,enabled:e.enabled,position:e.position,priority:e.priority,order:e.order,constant:e.constant,selectiveLogic:e.selectiveLogic,caseSensitive:e.caseSensitive,matchWholeWords:e.matchWholeWords,optionalFilter:e.optionalFilter,group:e.group,probability:e.probability,recursive:e.recursive,sticky:e.sticky,cooldown:e.cooldown,delay:e.delay,nonRecursable:e.nonRecursable,blockFurther:e.blockFurther,delayLevel:e.delayLevel,maxRecursionSteps:e.maxRecursionSteps})),settings:r.settings,metadata:r.metadata}}};export{f as a};
